<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ 109ç§è¯­è¨€ Â· é™æ€ç¿»è¯‘å™¨ï¼ˆæœ‰é“APIï¼‰</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        }
        body {
            background: linear-gradient(145deg, #f8faff 0%, #edf2f9 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }
        .card {
            max-width: 900px;
            width: 100%;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 2.5rem;
            box-shadow: 0 30px 60px rgba(0, 10, 30, 0.2), inset 0 1px 1px rgba(255,255,255,0.7);
            padding: 2rem 2rem 2.5rem;
            border: 1px solid rgba(255,255,255,0.5);
        }
        h1 {
            font-size: 2rem;
            font-weight: 600;
            margin: 0 0 0.25rem 0;
            background: linear-gradient(135deg, #1a2e4d, #2c3e6e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .subhead {
            color: #4a5b7a;
            font-size: 0.95rem;
            margin-bottom: 2rem;
            border-left: 3px solid #3b7cff;
            padding-left: 1rem;
            background: #eef4fe80;
            border-radius: 0 1rem 1rem 0;
            line-height: 1.5;
        }
        .subhead code {
            background: #dde5f5;
            padding: 0.2rem 0.6rem;
            border-radius: 2rem;
            font-size: 0.85rem;
            color: #112b5e;
        }
        .translate-panel {
            display: flex;
            flex-direction: column;
            gap: 1.8rem;
        }
        .input-area {
            background: #ffffffcc;
            border-radius: 1.8rem;
            padding: 1.8rem 1.8rem 1.5rem;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.02), 0 8px 18px -8px rgba(0,40,80,0.1);
            border: 1px solid rgba(255,255,255,0.9);
        }
        .lang-selectors {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
        }
        .lang-item {
            flex: 1 1 200px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f1f5fe;
            border-radius: 3rem;
            padding: 0.2rem 0.2rem 0.2rem 1.5rem;
            border: 1px solid #cddcff;
        }
        .lang-item span {
            color: #21487e;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .lang-item select {
            flex: 1;
            background: white;
            border: none;
            padding: 0.7rem 1rem;
            border-radius: 3rem;
            font-size: 0.95rem;
            font-weight: 450;
            color: #0a1b38;
            cursor: pointer;
            border: 1px solid transparent;
            box-shadow: 0 2px 6px rgba(0,20,40,0.08);
            transition: 0.2s;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="%233b7cff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.1rem;
        }
        .lang-item select:hover {
            border-color: #3b7cff;
            background-color: #f6faff;
        }
        textarea {
            width: 100%;
            border: none;
            background: #f6faff;
            border-radius: 1.5rem;
            padding: 1.2rem 1.5rem;
            font-size: 1.2rem;
            line-height: 1.5;
            resize: vertical;
            min-height: 120px;
            border: 2px solid transparent;
            transition: 0.2s;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.02);
            font-family: inherit;
        }
        textarea:focus {
            outline: none;
            border-color: #3b7cff;
            background: white;
        }
        .action-row {
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
        }
        button {
            background: #1f2f52;
            border: none;
            color: white;
            font-size: 1.1rem;
            font-weight: 550;
            padding: 0.9rem 2.6rem;
            border-radius: 3rem;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            box-shadow: 0 10px 18px -6px #1f2f5250, 0 0 0 1px #ffffff50 inset;
            transition: 0.15s;
            letter-spacing: 0.3px;
        }
        button:hover {
            background: #2b3e68;
            transform: scale(1.02);
            box-shadow: 0 14px 24px -8px #0f2640;
        }
        button:active {
            transform: scale(0.98);
        }
        .result-area {
            background: #ffffffd9;
            backdrop-filter: blur(4px);
            border-radius: 1.8rem;
            padding: 1.8rem;
            border: 1px solid white;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            box-shadow: 0 10px 20px -10px rgba(0,20,50,0.15);
        }
        .result-block {
            background: #f0f5ff;
            border-radius: 1.2rem;
            padding: 1.4rem 1.8rem;
        }
        .result-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #3b5e9c;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .translated-text {
            font-size: 1.6rem;
            font-weight: 550;
            color: #03122e;
            line-height: 1.3;
            word-break: break-word;
        }
        .meta-info {
            display: flex;
            flex-wrap: wrap;
            gap: 1.2rem;
            margin-top: 0.8rem;
            font-size: 0.95rem;
            color: #2d446b;
        }
        .meta-info span {
            background: #dde6fb;
            padding: 0.3rem 1rem;
            border-radius: 2rem;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }
        .pronounce {
            font-style: italic;
            border-left: 2px solid #3b7cff;
            padding-left: 0.8rem;
            background: none;
        }
        .error-message {
            color: #b40c2f;
            background: #ffe8ec;
            padding: 1rem 1.5rem;
            border-radius: 3rem;
            font-weight: 500;
        }
        .footer-note {
            margin-top: 1.2rem;
            font-size: 0.85rem;
            color: #4c6590;
            text-align: center;
            opacity: 0.8;
        }
        .loading {
            display: inline-block;
            width: 1.3rem;
            height: 1.3rem;
            border: 2px solid #ffffff80;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .swap-icon {
            font-size: 1.2rem;
            color: #3b7cff;
            background: white;
            width: 2.4rem;
            height: 2.4rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,40,100,0.1);
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ“¡ é™æ€ç¿»è¯‘ Â· 109ç§è¯­è¨€</h1>
        <div class="subhead">
            âš¡ é€šè¿‡ <code>https://60s.viki.moe/v2/fanyi</code> ç›´æ¥è¿æ¥ Â· æ•°æ®æºäºæœ‰é“ Â· å®Œå…¨é™æ€
        </div>

        <div class="translate-panel">
            <div class="input-area">
                <div class="lang-selectors">
                    <div class="lang-item">
                        <span>ğŸ”¤ æºè¯­è¨€</span>
                        <select id="fromLang" title="æºè¯­è¨€"></select>
                    </div>
                    <div class="swap-icon">â‡„</div>
                    <div class="lang-item">
                        <span>ğŸ¯ ç›®æ ‡è¯­è¨€</span>
                        <select id="toLang" title="ç›®æ ‡è¯­è¨€"></select>
                    </div>
                </div>
                <textarea id="sourceText" placeholder="è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬â€¦ ä¾‹å¦‚: Hello world æˆ– ã“ã‚“ã«ã¡ã¯">ã“ã‚“ã«ã¡ã¯</textarea>
                <div class="action-row">
                    <button id="translateBtn">
                        <span>ğŸŒ</span> ç¿»è¯‘
                    </button>
                </div>
            </div>

            <div class="result-area" id="resultArea">
                <!-- åŠ¨æ€ç»“æœä¼šæ¸²æŸ“åˆ°è¿™é‡Œ -->
                <div class="result-block" id="sourceBlock">
                    <div class="result-label"><span>ğŸ“„ åŸæ–‡</span></div>
                    <div class="translated-text" id="sourceTextDisplay">â€”</div>
                    <div class="meta-info" id="sourceMeta"></div>
                </div>
                <div class="result-block" id="targetBlock">
                    <div class="result-label"><span>âœ… è¯‘æ–‡</span></div>
                    <div class="translated-text" id="targetTextDisplay">â€”</div>
                    <div class="meta-info" id="targetMeta"></div>
                </div>
            </div>
            <div class="footer-note">
                ğŸŒ è¯­è¨€åˆ—è¡¨åŠ¨æ€åŠ è½½è‡ª <code>/fanyi/langs</code> Â· å¦‚å¤±è´¥åˆ™ä½¿ç”¨å¸¸ç”¨å¤‡é€‰
            </div>
        </div>
    </div>

    <script>
        (function() {
            // æ ¸å¿ƒé…ç½®
            const API_BASE = 'https://60s.viki.moe';
            const TRANSLATE_PATH = '/v2/fanyi';
            const LANGS_PATH = '/fanyi/langs';

            // å¸¸ç”¨è¯­è¨€ fallback (ä»£ç  -> å±•ç¤ºå)  æœ‰é“å¸¸è§ä»£ç 
            const FALLBACK_LANGS = {
                'auto': 'ğŸŒ è‡ªåŠ¨æ£€æµ‹',
                'zh-CHS': 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡(ç®€ä½“)',
                'en': 'ğŸ‡¬ğŸ‡§ è‹±æ–‡',
                'ja': 'ğŸ‡¯ğŸ‡µ æ—¥æ–‡',
                'ko': 'ğŸ‡°ğŸ‡· éŸ©æ–‡',
                'fr': 'ğŸ‡«ğŸ‡· æ³•æ–‡',
                'de': 'ğŸ‡©ğŸ‡ª å¾·æ–‡',
                'ru': 'ğŸ‡·ğŸ‡º ä¿„æ–‡',
                'es': 'ğŸ‡ªğŸ‡¸ è¥¿ç­ç‰™æ–‡',
                'pt': 'ğŸ‡µğŸ‡¹ è‘¡è„ç‰™æ–‡',
                'it': 'ğŸ‡®ğŸ‡¹ æ„å¤§åˆ©æ–‡',
                'th': 'ğŸ‡¹ğŸ‡­ æ³°æ–‡',
                'vi': 'ğŸ‡»ğŸ‡³ è¶Šå—æ–‡',
                'ar': 'ğŸ‡¸ğŸ‡¦ é˜¿æ‹‰ä¼¯æ–‡',
                'hi': 'ğŸ‡®ğŸ‡³ å°åœ°æ–‡'
            };

            // DOM å…ƒç´ 
            const fromSelect = document.getElementById('fromLang');
            const toSelect = document.getElementById('toLang');
            const sourceTextArea = document.getElementById('sourceText');
            const translateBtn = document.getElementById('translateBtn');

            // ç»“æœæ˜¾ç¤ºåŒºåŸŸ
            const sourceTextDisplay = document.getElementById('sourceTextDisplay');
            const targetTextDisplay = document.getElementById('targetTextDisplay');
            const sourceMeta = document.getElementById('sourceMeta');
            const targetMeta = document.getElementById('targetMeta');

            // çŠ¶æ€æ ‡è®°
            let isLoadingLangs = true;

            // ---------- å¡«å……è¯­è¨€ä¸‹æ‹‰ ----------
            async function loadLanguages() {
                try {
                    // å°è¯•è·å–çœŸå®è¯­è¨€åˆ—è¡¨
                    const response = await fetch(`${API_BASE}${LANGS_PATH}`, {
                        method: 'GET',
                        mode: 'cors',
                        headers: { 'Accept': 'application/json' }
                    });
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    
                    // è§£æè¿”å›çš„æ•°æ® (å¸¸è§æ ¼å¼1: å¯¹è±¡ { "en":"è‹±æ–‡", "zh-CHS":"ä¸­æ–‡" ... }  æ ¼å¼2: æ•°ç»„ [{code:"en",name:"è‹±æ–‡"}])
                    let langMap = new Map();
                    
                    if (typeof data === 'object' && data !== null) {
                        if (Array.isArray(data)) {
                            // æ•°ç»„æƒ…å†µ: å¯èƒ½æ¯ä¸ªå…ƒç´ æœ‰ code, name
                            data.forEach(item => {
                                if (item.code && item.name) langMap.set(item.code, item.name);
                                else if (item.lang && item.name) langMap.set(item.lang, item.name); // å˜ç§
                            });
                        } else {
                            // å¯¹è±¡: é”®ä¸ºcode, å€¼ä¸ºåç§°
                            Object.entries(data).forEach(([code, name]) => {
                                if (typeof name === 'string') langMap.set(code, name);
                            });
                        }
                    }
                    
                    // å¦‚æœè§£æåè¿autoéƒ½æ²¡æœ‰ï¼Œå°±åˆå¹¶fallback (ä½†è‡³å°‘ä¿ç•™auto)
                    if (!langMap.has('auto')) {
                        langMap.set('auto', 'ğŸŒ è‡ªåŠ¨æ£€æµ‹');
                    }
                    
                    // å¦‚æœè¯­è¨€ä¸è¶³3ä¸ªï¼Œè¯´æ˜è§£æå¯èƒ½å¤±è´¥ï¼Œä½¿ç”¨fallbackæ‰©å……ä½†ä¿ç•™å·²æœ‰çš„
                    if (langMap.size < 5) {
                        // åˆå¹¶ fallback (ä¸è¦†ç›–å·²æœ‰çš„)
                        Object.entries(FALLBACK_LANGS).forEach(([code, name]) => {
                            if (!langMap.has(code)) langMap.set(code, name);
                        });
                    }
                    
                    populateSelects(langMap);
                } catch (err) {
                    console.warn('è¯­è¨€åˆ—è¡¨åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨åˆ—è¡¨', err);
                    // ä½¿ç”¨ fallback æ„é€  Map
                    const fallbackMap = new Map(Object.entries(FALLBACK_LANGS));
                    populateSelects(fallbackMap);
                } finally {
                    isLoadingLangs = false;
                }
            }

            // å¡«å……ä¸¤ä¸ªä¸‹æ‹‰æ¡†
            function populateSelects(langMap) {
                // ç”Ÿæˆé€‰é¡¹HTML (ä¿ç•™autoæ°¸è¿œåœ¨æœ€å‰)
                let optionsHtml = [];
                // å…ˆæŠŠautoæŒ‘å‡ºæ¥æ”¾æœ€å‰
                if (langMap.has('auto')) {
                    optionsHtml.push(`<option value="auto">${langMap.get('auto')}</option>`);
                    langMap.delete('auto');
                }
                // å…¶ä½™æŒ‰åç§°æ’åº
                const sorted = Array.from(langMap.entries()).sort((a, b) => a[1].localeCompare(b[1]));
                sorted.forEach(([code, name]) => {
                    optionsHtml.push(`<option value="${code}">${name}</option>`);
                });

                const optionsString = optionsHtml.join('');
                fromSelect.innerHTML = optionsString;
                toSelect.innerHTML = optionsString;

                // è®¾ç½®é»˜è®¤å€¼: æºè¯­è¨€auto, ç›®æ ‡è¯­è¨€auto (å¦‚æœæœ‰è‹±æ–‡ä¹Ÿå¯é€‰è‹±æ–‡ï¼Œè¿™é‡Œä¿ç•™autoï¼Œé€»è¾‘ä¸APIé»˜è®¤ä¸€è‡´)
                fromSelect.value = 'auto';
                // å¦‚æœå­˜åœ¨è‹±æ–‡ï¼Œé»˜è®¤ç›®æ ‡å¯é€‰è‹±æ–‡ï¼Ÿä½†APIé»˜è®¤to=autoæœ‰ç‰¹æ®Šé€»è¾‘ï¼šæºè¯­è¨€ä¸ºä¸­æ–‡åˆ™ç›®æ ‡è‹±æ–‡ï¼Œå¦åˆ™ä¸­æ–‡ã€‚æ‰€ä»¥æˆ‘ä»¬ä¿ç•™autoè®©APIå†³å®šã€‚
                toSelect.value = 'auto';
            }

            // ---------- ç¿»è¯‘æ ¸å¿ƒ ----------
            async function performTranslation() {
                const text = sourceTextArea.value.trim();
                if (!text) {
                    alert('è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬');
                    return;
                }

                const from = fromSelect.value;
                const to = toSelect.value;

                // æŒ‰é’®loadingçŠ¶æ€
                const originalBtnText = translateBtn.innerHTML;
                translateBtn.innerHTML = `<span class="loading"></span> ç¿»è¯‘ä¸­`;
                translateBtn.disabled = true;

                try {
                    // æ„é€  URL å‚æ•°
                    const params = new URLSearchParams({
                        text: text,
                        from: from,
                        to: to,
                        // encoding ä¸ä¼ é»˜è®¤json
                    });
                    const url = `${API_BASE}${TRANSLATE_PATH}?${params.toString()}`;

                    const response = await fetch(url, {
                        method: 'GET',
                        mode: 'cors',
                        headers: { 'Accept': 'application/json' }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    // æ ¹æ®OpenAPIè§„èŒƒè§£æï¼šcode, message, data { source, target }
                    if (result.code === 0 || result.code === 200 || (result.data && result.data.source)) {
                        // å…¼å®¹ä¸€äº›codeè®¾è®¡ (æœ‰äº›æ¥å£codeè¿”å›0æˆåŠŸ)
                        displayResult(result.data);
                    } else {
                        throw new Error(result.message || 'ç¿»è¯‘æœåŠ¡è¿”å›å¼‚å¸¸');
                    }
                } catch (error) {
                    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯åˆ°ç»“æœåŒº
                    sourceTextDisplay.innerText = 'âš ï¸ å‡ºé”™';
                    targetTextDisplay.innerText = 'æ— æ³•ç¿»è¯‘';
                    sourceMeta.innerHTML = `<span class="error-message">${error.message}</span>`;
                    targetMeta.innerHTML = '';
                    console.error(error);
                } finally {
                    translateBtn.innerHTML = originalBtnText;
                    translateBtn.disabled = false;
                }
            }

            // å±•ç¤ºç¿»è¯‘ç»“æœ
            function displayResult(data) {
                if (!data || !data.source || !data.target) {
                    sourceTextDisplay.innerText = 'â€”';
                    targetTextDisplay.innerText = 'â€”';
                    sourceMeta.innerHTML = '<span>è¿”å›æ•°æ®ç»“æ„å¼‚å¸¸</span>';
                    targetMeta.innerHTML = '';
                    return;
                }

                const src = data.source;
                const tgt = data.target;

                // åŸæ–‡
                sourceTextDisplay.innerText = src.text || 'â€”';
                let srcMetaHtml = '';
                if (src.type_desc) srcMetaHtml += `<span>ğŸ”¤ ${src.type_desc}</span>`;
                if (src.pronounce && src.pronounce.trim()) srcMetaHtml += `<span class="pronounce">ğŸ—£ï¸ ${src.pronounce}</span>`;
                sourceMeta.innerHTML = srcMetaHtml || '<span>â€”</span>';

                // è¯‘æ–‡
                targetTextDisplay.innerText = tgt.text || 'â€”';
                let tgtMetaHtml = '';
                if (tgt.type_desc) tgtMetaHtml += `<span>ğŸ”¤ ${tgt.type_desc}</span>`;
                if (tgt.pronounce && tgt.pronounce.trim()) tgtMetaHtml += `<span class="pronounce">ğŸ—£ï¸ ${tgt.pronounce}</span>`;
                targetMeta.innerHTML = tgtMetaHtml || '<span>â€”</span>';
            }

            // ---------- åˆå§‹åŒ–é¡µé¢ ----------
            async function init() {
                // åŠ è½½è¯­è¨€
                await loadLanguages();

                // é»˜è®¤demoå¡«å……åŸæ–‡ç¤ºä¾‹ (å·²ç»å†™åœ¨textareaé‡Œäº†)
                // é¦–æ¬¡è‡ªåŠ¨ç¿»è¯‘ç¤ºä¾‹ï¼Ÿä¸ºäº†ä¸é¢‘ç¹è¯·æ±‚ï¼Œå¯ä»¥æ‰‹åŠ¨ç‚¹å‡»æˆ–è€…è‡ªåŠ¨å°è¯•ä¸€æ¬¡ (å¯é€‰)
                // ä¸ºäº†è®©ç”¨æˆ·ç›´è§‚çœ‹åˆ°æ•ˆæœï¼Œå¯ä¸»åŠ¨æ‰§è¡Œä¸€æ¬¡ç¿»è¯‘ (å¦‚æœåŸæ–‡ä¸ä¸ºç©º)
                if (sourceTextArea.value.trim() !== '') {
                    // å»¶è¿Ÿä¸€ç‚¹ç‚¹ï¼Œç­‰DOMç¨³å®š
                    setTimeout(() => performTranslation(), 100);
                }

                // ç»‘å®šäº‹ä»¶
                translateBtn.addEventListener('click', performTranslation);

                // æŒ‰å›è½¦å¿«æ·ç¿»è¯‘ (Ctrl+Enter)
                sourceTextArea.addEventListener('keydown', (e) => {
                    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                        e.preventDefault();
                        performTranslation();
                    }
                });
            }

            // å¯åŠ¨
            init();
        })();
    </script>
</body>
</html>
