<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>卡西欧 fx-991CN X 科学计算器</title>
    <style>

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @font-face {
            font-family: 'ClassWiz';
            src: url('ClassWizXDisplay-Regular.ttf');
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            padding: 20px;
        }
        
        .calculator {
            width: 330px;
            background: #d0d0d0;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }
        
        .display {
            background: #a6b4be;
            padding: 15px;
            border-bottom: 2px solid #8a98a4;
        }
        
        .display-main {
            background: #e9e9e9;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            min-height: 60px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
            text-align: right;
            font-size: 24px;
            overflow: hidden;
            white-space: nowrap;
            position: relative;
        }
        
        .display-sub {
            background: #d1dae0;
            border-radius: 5px;
            padding: 8px;
            min-height: 40px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
            text-align: right;
            font-size: 18px;
            overflow: hidden;
            white-space: nowrap;
        }
        
        .cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background-color: #000;
            animation: blink 1s infinite;
            vertical-align: middle;
            margin: 0 2px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .indicators {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
            color: #333;
        }
        
        .indicator {
            padding: 2px 5px;
            background: #bcc7cf;
            border-radius: 3px;
            display: none;
        }
        
        .indicator.active {
            display: block;
        }
        
        .keypad {
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 6px;
        }
        
        .btn {
            padding: 8px 0;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            background: linear-gradient(to bottom, #f9f9f9, #e6e6e6);
            color: #333;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);
            transition: all 0.1s;
            grid-column: span 1;
        }
        
        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
            background: linear-gradient(to bottom, #e6e6e6, #d9d9d9);
        }
        
        .btn.span-2 {
            grid-column: span 2;
        }
        
        .btn.orange {
            background: linear-gradient(to bottom, #ff9500, #e68500);
            color: white;
        }
        
        .btn.red {
            background: linear-gradient(to bottom, #ff3b30, #e62e25);
            color: white;
        }
        
        .btn.blue {
            background: linear-gradient(to bottom, #5ac8fa, #4cb5e6);
            color: white;
        }
        
        .btn.green {
            background: linear-gradient(to bottom, #4cd964, #3cc553);
            color: white;
        }
        
        .btn.shift {
            background: linear-gradient(to bottom, #007aff, #006ee6);
            color: white;
        }
        
        .btn.alpha {
            background: linear-gradient(to bottom, #5856d6, #4a48c2);
            color: white;
        }
        
        .btn.active {
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.4);
        }
        
        .brand {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            padding-top: 5px;
        }
        
        .model {
            text-align: center;
            font-size: 14px;
            color: #555;
            margin-bottom: 15px;
        }
        
        .catalog {
            display: none;
            background: #c8d2d9;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .catalog-item {
            padding: 8px 5px;
            margin: 2px 0;
            background: #e0e6eb;
            border-radius: 3px;
            text-align: center;
            cursor: pointer;
            font-size: 14px;
        }
        
        .catalog-item:hover {
            background: #d4dce3;
        }
        
        .catalog-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        
        .catalog-btn {
            padding: 5px;
            background: #b4c1cb;
            border-radius: 3px;
            text-align: center;
            cursor: pointer;
            font-size: 12px;
            flex: 1;
            margin: 0 2px;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <div class="brand">CASIO</div>
        <div class="model">fx-991CN CW</div>
        
        <div class="display">
            <div class="indicators">
                <div class="indicator" id="shift-indicator">S</div>
                <div class="indicator" id="alpha-indicator">A</div>
                <div class="indicator" id="catalog-indicator">CATALOG</div>
            </div>
            <div class="display-sub" id="sub-display"></div>
            <div class="display-main" id="main-display">0</div>
        </div>
        
        <div class="keypad">
            <!-- 第一行 -->
            <button class="btn red" id="power">ON</button>
            <button class="btn shift" id="shift">SHIFT</button>
            <button class="btn alpha" id="alpha">ALPHA</button>
            <button class="btn blue" id="ctl">OPTN</button>
            <button class="btn" id="calc">CALC</button>
            <button class="btn" id="sto">STO</button>
            <button class="btn" id="eng">ENG</button>
            <button class="btn orange" id="del">DEL</button>
            
            <!-- 第二行 -->
            <button class="btn" data-value="7">7</button>
            <button class="btn" data-value="8">8</button>
            <button class="btn" data-value="9">9</button>
            <button class="btn orange" data-value="÷">÷</button>
            <button class="btn" data-value="(">(</button>
            <button class="btn" data-value=")">)</button>
            <button class="btn" id="fact">x!</button>
            <button class="btn orange" id="ac">AC</button>
            
            <!-- 第三行 -->
            <button class="btn" data-value="4">4</button>
            <button class="btn" data-value="5">5</button>
            <button class="btn" data-value="6">6</button>
            <button class="btn orange" data-value="×">×</button>
            <button class="btn" id="ans">Ans</button>
            <button class="btn" data-value=",">,</button>
            <button class="btn" id="hyp">hyp</button>
            <button class="btn" id="sin">sin</button>
            
            <!-- 第四行 -->
            <button class="btn" data-value="1">1</button>
            <button class="btn" data-value="2">2</button>
            <button class="btn" data-value="3">3</button>
            <button class="btn orange" data-value="-">-</button>
            <button class="btn" id="m-plus">M+</button>
            <button class="btn" id="m-minus">M-</button>
            <button class="btn" id="rcl">RCL</button>
            <button class="btn" id="cos">cos</button>
            
            <!-- 第五行 -->
            <button class="btn" data-value="0">0</button>
            <button class="btn" data-value=".">.</button>
            <button class="btn" id="exp">EXP</button>
            <button class="btn orange" data-value="+">+</button>
            <button class="btn green" id="equals">=</button>
            <button class="btn" id="mode">MODE</button>
            <button class="btn" id="setup">SETUP</button>
            <button class="btn" id="tan">tan</button>
            
            <!-- 第六行 -->
            <button class="btn" id="left">◀</button>
            <button class="btn" id="right">▶</button>
            <button class="btn" id="up">▲</button>
            <button class="btn" id="down">▼</button>
            <button class="btn" id="log">log</button>
            <button class="btn" id="ln">ln</button>
            <button class="btn" id="square">x²</button>
            <button class="btn" id="sqrt">√</button>
        </div>
        
        <div class="catalog" id="catalog">
            <div class="catalog-item" data-value="∑(">1. ∑(</div>
            <div class="catalog-item" data-value="∏(">2. ∏(</div>
            <div class="catalog-item" data-value="sin(">3. sin(</div>
            <div class="catalog-item" data-value="cos(">4. cos(</div>
            <div class="catalog-item" data-value="tan(">5. tan(</div>
            <div class="catalog-item" data-value="sinh(">6. sinh(</div>
            <div class="catalog-item" data-value="cosh(">7. cosh(</div>
            <div class="catalog-item" data-value="tanh(">8. tanh(</div>
            <div class="catalog-item" data-value="sin⁻¹(">9. sin⁻¹(</div>
            <div class="catalog-item" data-value="cos⁻¹(">10. cos⁻¹(</div>
            <div class="catalog-item" data-value="tan⁻¹(">11. tan⁻¹(</div>
            <div class="catalog-item" data-value="sinh⁻¹(">12. sinh⁻¹(</div>
            <div class="catalog-item" data-value="cosh⁻¹(">13. cosh⁻¹(</div>
            <div class="catalog-item" data-value="tanh⁻¹(">14. tanh⁻¹(</div>
            <div class="catalog-item" data-value="∫(">15. ∫(</div>
            
            <div class="catalog-nav">
                <div class="catalog-btn" id="catalog-prev">◀ 上页</div>
                <div class="catalog-btn" id="catalog-next">下页 ▶</div>
                <div class="catalog-btn" id="catalog-close">关闭</div>
            </div>
        </div>
    </div>

    <script>
        // 计算器核心功能
        document.addEventListener('DOMContentLoaded', function() {
            const mainDisplay = document.getElementById('main-display');
            const subDisplay = document.getElementById('sub-display');
            const shiftIndicator = document.getElementById('shift-indicator');
            const alphaIndicator = document.getElementById('alpha-indicator');
            const catalogIndicator = document.getElementById('catalog-indicator');
            const catalog = document.getElementById('catalog');
            
            let currentInput = '0';
            let previousInput = '';
            let operation = null;
            let resetScreen = false;
            let shiftActive = false;
            let alphaActive = false;
            let catalogActive = false;
            let cursorPosition = 0;
            let memory = 0;
            let lastAnswer = 0;
            
            // 初始化显示
            updateDisplay();
            
            // 数字按钮事件
            document.querySelectorAll('.btn[data-value]').forEach(button => {
                button.addEventListener('click', () => {
                    if (resetScreen) {
                        currentInput = '0';
                        resetScreen = false;
                    }
                    
                    const value = button.getAttribute('data-value');
                    
                    if (currentInput === '0' && value !== '.') {
                        currentInput = value;
                    } else {
                        currentInput += value;
                    }
                    
                    updateDisplay();
                });
            });
            
            // 运算符按钮事件
            document.querySelectorAll('.btn.orange').forEach(button => {
                button.addEventListener('click', () => {
                    if (button.id !== 'del' && button.id !== 'ac') {
                        const value = button.getAttribute('data-value');
                        currentInput += value;
                        updateDisplay();
                    }
                });
            });
            
            // 等号按钮
            document.getElementById('equals').addEventListener('click', () => {
                calculate();
                updateDisplay();
            });
            
            // 清除按钮
            document.getElementById('ac').addEventListener('click', () => {
                currentInput = '0';
                previousInput = '';
                operation = null;
                updateDisplay();
            });
            
            // 删除按钮
            document.getElementById('del').addEventListener('click', () => {
                if (currentInput.length > 1) {
                    currentInput = currentInput.slice(0, -1);
                } else {
                    currentInput = '0';
                }
                updateDisplay();
            });
            
            // SHIFT按钮
            document.getElementById('shift').addEventListener('click', () => {
                shiftActive = !shiftActive;
                shiftIndicator.classList.toggle('active', shiftActive);
                
                if (shiftActive) {
                    alphaActive = false;
                    alphaIndicator.classList.remove('active');
                }
            });
            
            // ALPHA按钮
            document.getElementById('alpha').addEventListener('click', () => {
                alphaActive = !alphaActive;
                alphaIndicator.classList.toggle('active', alphaActive);
                
                if (alphaActive) {
                    shiftActive = false;
                    shiftIndicator.classList.remove('active');
                }
            });
            
            // OPTN按钮 (目录)
            document.getElementById('ctl').addEventListener('click', () => {
                catalogActive = !catalogActive;
                catalog.style.display = catalogActive ? 'block' : 'none';
                catalogIndicator.classList.toggle('active', catalogActive);
            });
            
            // 目录项点击事件
            document.querySelectorAll('.catalog-item').forEach(item => {
                item.addEventListener('click', () => {
                    const value = item.getAttribute('data-value');
                    currentInput += value;
                    catalogActive = false;
                    catalog.style.display = 'none';
                    catalogIndicator.classList.remove('active');
                    updateDisplay();
                });
            });
            
            // 目录关闭按钮
            document.getElementById('catalog-close').addEventListener('click', () => {
                catalogActive = false;
                catalog.style.display = 'none';
                catalogIndicator.classList.remove('active');
            });
            
            // 其他功能按钮
            document.getElementById('ans').addEventListener('click', () => {
                currentInput += lastAnswer;
                updateDisplay();
            });
            
            document.getElementById('sqrt').addEventListener('click', () => {
                currentInput += '√(';
                updateDisplay();
            });
            
            document.getElementById('square').addEventListener('click', () => {
                currentInput += '^2';
                updateDisplay();
            });
            
            document.getElementById('sin').addEventListener('click', () => {
                currentInput += 'sin(';
                updateDisplay();
            });
            
            document.getElementById('cos').addEventListener('click', () => {
                currentInput += 'cos(';
                updateDisplay();
            });
            
            document.getElementById('tan').addEventListener('click', () => {
                currentInput += 'tan(';
                updateDisplay();
            });
            
            document.getElementById('log').addEventListener('click', () => {
                currentInput += 'log(';
                updateDisplay();
            });
            
            document.getElementById('ln').addEventListener('click', () => {
                currentInput += 'ln(';
                updateDisplay();
            });
            
            document.getElementById('exp').addEventListener('click', () => {
                currentInput += 'E';
                updateDisplay();
            });
            
            // 更新显示
            function updateDisplay() {
                mainDisplay.textContent = currentInput;
                subDisplay.textContent = previousInput;
                
                // 光标模拟
                if (cursorPosition > 0) {
                    mainDisplay.textContent = currentInput.slice(0, cursorPosition) + 
                                            '|' + 
                                            currentInput.slice(cursorPosition);
                }
            }
            
            // 计算函数
            function calculate() {
                try {
                    // 替换运算符
                    let expression = currentInput
                        .replace(/×/g, '*')
                        .replace(/÷/g, '/')
                        .replace(/π/g, Math.PI)
                        .replace(/√\(/g, 'Math.sqrt(')
                        .replace(/sin\(/g, 'Math.sin(')
                        .replace(/cos\(/g, 'Math.cos(')
                        .replace(/tan\(/g, 'Math.tan(')
                        .replace(/log\(/g, 'Math.log10(')
                        .replace(/ln\(/g, 'Math.log(')
                        .replace(/∑\(/g, 'summation(')
                        .replace(/∏\(/g, 'product(')
                        .replace(/∫\(/g, 'integrate(');
                    
                    // 处理幂运算
                    expression = expression.replace(/\^/g, '**');
                    
                    // 使用Function计算
                    const result = new Function('return ' + expression)();
                    
                    // 保存结果
                    previousInput = currentInput + '=';
                    currentInput = formatResult(result);
                    lastAnswer = result;
                    
                } catch (error) {
                    currentInput = '错误';
                    setTimeout(() => {
                        currentInput = '0';
                        updateDisplay();
                    }, 1500);
                }
            }
            
            // 格式化结果
            function formatResult(num) {
                if (typeof num !== 'number') return num;
                
                // 处理极大或极小的数字
                if (Math.abs(num) > 1e10 || (Math.abs(num) < 1e-10 && num !== 0)) {
                    return num.toExponential(8);
                }
                
                // 处理小数位数
                const str = num.toString();
                if (str.includes('.')) {
                    const parts = str.split('.');
                    if (parts[1].length > 10) {
                        return num.toFixed(10).replace(/\.?0+$/, '');
                    }
                }
                
                return str;
            }
            
            // 求和函数
            function summation(expr, start, end) {
                let sum = 0;
                for (let x = start; x <= end; x++) {
                    // 这里需要解析expr中的x变量
                    const value = new Function('x', 'return ' + expr)(x);
                    sum += value;
                }
                return sum;
            }
            
            // 求积函数
            function product(expr, start, end) {
                let prod = 1;
                for (let x = start; x <= end; x++) {
                    const value = new Function('x', 'return ' + expr)(x);
                    prod *= value;
                }
                return prod;
            }
            
            // 积分函数
            function integrate(expr, a, b) {
                // 使用辛普森法则进行数值积分
                const n = 1000; // 分割数
                const h = (b - a) / n;
                let sum = new Function('x', 'return ' + expr)(a) + new Function('x', 'return ' + expr)(b);
                
                for (let i = 1; i < n; i++) {
                    const x = a + i * h;
                    const coefficient = i % 2 === 0 ? 2 : 4;
                    sum += coefficient * new Function('x', 'return ' + expr)(x);
                }
                
                return sum * h / 3;
            }
            
            // 方向键功能
            document.getElementById('left').addEventListener('click', () => {
                if (cursorPosition > 0) cursorPosition--;
                updateDisplay();
            });
            
            document.getElementById('right').addEventListener('click', () => {
                if (cursorPosition < currentInput.length) cursorPosition++;
                updateDisplay();
            });
            
            // 初始光标位置
            cursorPosition = currentInput.length;
            updateDisplay();
        });
    </script>
</body>
</html>
